import{_ as p,c as o,a as t,t as d,F as f,r as h,n as v,b as m,w as g,v as b,o as n}from"./index-kQHywmgF.js";const y={name:"Upload",data(){return{residue_ids:"",residue_num:"",projectId:null,isTask:!1,downloadLinks:{},isCompleted:!1,statusProgress:null,statusExp:null,isError:!1,errorInfo:null,isFail:!1,failInfo:null,apiBase:"http://127.0.0.1:8000",viewerInstance:null}},computed:{progressWidth(){switch(this.statusProgress){case"init":return"20%";case"cleaned":return"50%";case"calculated":return"75%";case"modified":return"99%";default:return"10%"}},statusExplain(){switch(this.statusProgress){case"init":return"2/6 Initialized";case"cleaned":return"3/6 Cleaned";case"calculated":return"4/6 Calculated";case"modified":return"5/6 Modifiled";default:return"1/6 Searching"}}},methods:{async fetchStatus(){if(this.queryInterval&&clearInterval(this.queryInterval),!this.projectId){alert("Please make sure project id is typed in!");return}try{this.isTask=!0,this.isCompleted=!1;let r=setInterval(async()=>{try{const e=await fetch(`${this.apiBase}/project/`+this.projectId),l=await e.json();if(l.status==="failed")clearInterval(r),this.isFail=!0,this.failInfo=l.error;else if(l.status==="completed"){clearInterval(r),this.isCompleted=!0,this.downloadLinks={};for(const u in l.files)this.downloadLinks[u]=`${this.apiBase}/download/${this.projectId}/${u}`}else e.status===404?(clearInterval(r),this.isFail=!0,this.failInfo="Project Not Found. Invalid ID, Project failed or expired."):e.ok?l.status==="processing"?this.statusProgress=l.progress:clearInterval(r):(clearInterval(r),this.isFail=!0,this.failInfo="Server Error")}catch(e){clearInterval(r),this.isError=!0,this.errorInfo="Network Error: "+e.message,console.error("Server or Network Error:",e)}},5e3)}catch(r){this.queryInterval&&clearInterval(this.queryInterval),this.isError=!0,this.errorInfo=r,console.error("Server or Network Error:",r)}},resetTask(){if(this.viewerInstance){const r=document.getElementById("viewer");r&&(r.innerHTML=""),this.viewerInstance=null}this.queryInterval&&clearInterval(this.queryInterval),this.projectId=null,this.isTask=!1,this.downloadLinks={},this.isCompleted=!1,this.statusProgress=null,this.isError=!1,this.errorInfo=null,this.isFail=!1,this.failInfo=null},loadAndRenderPDB(){const r=this.downloadLinks.motif_result_pdb;fetch(r).then(e=>{if(!e.ok)throw new Error(`网络请求错误，状态码：${e.status}`);return e.text()}).then(e=>{const l=document.getElementById("viewer");if(!l){console.error("未找到 id 为 viewer 的 DOM 元素");return}this.viewerInstance&&this.viewerInstance.clear(),this.viewerInstance=$3Dmol.createViewer(l,{backgroundColor:"0xffffff"}),this.viewerInstance.addModel(e,"pdb"),this.viewerInstance.setStyle({},{stick:{}}),this.viewerInstance.zoomTo(),this.viewerInstance.render()}).catch(e=>{console.error("加载 PDB 数据时发生错误：",e)})}},mounted(){this.isCompleted&&this.$nextTick(()=>{this.loadAndRenderPDB()})},watch:{isCompleted(r){r&&this.$nextTick(()=>{this.loadAndRenderPDB()})}}},w={key:0},I={key:0,class:"alert alert-success",role:"alert"},k={class:"badge badge-proj-title mb-4"},_={style:{display:"block"}},x={class:"btn-toolbar mb-3",role:"toolbar","aria-label":"Toolbar with button groups",style:{"margin-left":".5rem"}},j={class:"btn-group",role:"group"},T=["href"],E={key:1,class:"alert alert-danger",role:"alert",style:{color:"#000"}},C={style:{display:"block"}},P={style:{"margin-left":".5rem"}},S={key:2,class:"alert alert-danger",role:"alert",style:{color:"#000"}},z={class:"badge badge-proj-title mb-4"},B={style:{display:"block"}},D={style:{"margin-left":".5rem"}},A={key:3,class:"alert alert-proj",role:"alert"},F={class:"badge badge-proj-title mb-4"},L={style:{display:"block"}},N={style:{"font-size":"1.3rem","margin-left":".5rem"}},R={class:"progress",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100",style:{height:".5rem","margin-left":".5rem"}},q={key:1,class:"upload_pdb"},M={class:"input-group mb-3"};function V(r,e,l,u,s,a){return s.isTask?(n(),o("div",w,[s.isCompleted?(n(),o("div",I,[t("div",k,d(s.projectId),1),t("div",_,[e[6]||(e[6]=t("p",{style:{"font-size":"1.3rem","margin-left":".5rem"}},"6/6 Done!",-1)),e[7]||(e[7]=t("div",{class:"progress mb-4",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100",style:{height:".5rem","margin-left":".5rem"}},[t("div",{class:"progress-bar progress-bar-striped bg-success",style:{width:"100%"}})],-1)),t("div",x,[t("div",j,[e[5]||(e[5]=t("button",{class:"btn btn-light",disabled:"",style:{"font-size":".8rem"}},"Download:",-1)),(n(!0),o(f,null,h(s.downloadLinks,(i,c)=>(n(),o("a",{class:"btn btn-light",key:c,href:i,target:"_blank",style:{"font-size":".8rem"}},d(c),9,T))),128))])]),e[8]||(e[8]=t("div",{id:"viewer",style:{height:"400px",width:"400px",position:"relative","margin-left":".5rem"}},null,-1)),t("button",{class:"btn btn-warning mt-2",onClick:e[0]||(e[0]=(...i)=>a.resetTask&&a.resetTask(...i)),style:{"font-size":".8rem","margin-left":".5rem"}},"Reset")])])):s.isError?(n(),o("div",E,[e[11]||(e[11]=t("div",{class:"badge badge-proj-title mb-4"}," N/A ",-1)),t("div",C,[e[9]||(e[9]=t("p",{style:{"font-size":"1.3rem","margin-left":".5rem"}},"Server or Network Error",-1)),e[10]||(e[10]=t("div",{class:"progress mb-4",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100",style:{height:".5rem","margin-left":".5rem"}},[t("div",{class:"progress-bar progress-bar-striped bg-danger",style:{width:"10%"}})],-1)),t("p",P,d(s.errorInfo),1),t("button",{class:"btn btn-warning mt-2",onClick:e[1]||(e[1]=(...i)=>a.resetTask&&a.resetTask(...i)),style:{"font-size":".8rem","margin-left":".5rem"}},"Reset")])])):s.isFail?(n(),o("div",S,[t("div",z,d(s.projectId),1),t("div",B,[e[12]||(e[12]=t("p",{style:{"font-size":"1.3rem","margin-left":".5rem"}},"Job Failed",-1)),e[13]||(e[13]=t("div",{class:"progress mb-4",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100",style:{height:".5rem","margin-left":".5rem"}},[t("div",{class:"progress-bar progress-bar-striped bg-danger",style:{width:"100%"}})],-1)),t("p",D,d(s.failInfo),1),t("button",{class:"btn btn-warning mt-2",onClick:e[2]||(e[2]=(...i)=>a.resetTask&&a.resetTask(...i)),style:{"font-size":".8rem","margin-left":".5rem"}},"Reset")])])):(n(),o("div",A,[t("div",F,d(s.projectId),1),t("div",L,[t("p",N,d(a.statusExplain),1),t("div",R,[t("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:v({width:a.progressWidth})},null,4)])])])),e[14]||(e[14]=t("div",{class:"alert alert-warning",role:"alert"},[t("p",{class:"mb-1"},[t("b",null,"Note: Please keep your Project ID secure.")]),t("p",{class:"mb-0"},[m('Once completed, you can retrieve your file in the "Query" page.'),t("br"),m(" All files will be periodically deleted. Save your files promptly.")])],-1))])):(n(),o("div",q,[t("div",M,[g(t("input",{type:"text",class:"form-control",placeholder:"Project ID",id:"project_id","onUpdate:modelValue":e[3]||(e[3]=i=>s.projectId=i),required:""},null,512),[[b,s.projectId]]),t("button",{onClick:e[4]||(e[4]=(...i)=>a.fetchStatus&&a.fetchStatus(...i)),class:"btn btn-navy",type:"button"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5rem",height:"1.5rem",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"})],-1)]))])]))}const O=p(y,[["render",V],["__scopeId","data-v-e3cb25d9"]]);export{O as default};
